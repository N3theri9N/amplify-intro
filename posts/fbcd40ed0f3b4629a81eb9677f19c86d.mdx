---
title: ë¸”ë¡œê·¸ ì œì‘ê¸° 2.mdx, rehype
date: 2024-01-30 12:11
tag: Blog,FrontEnd
---
# ìˆ˜ì •í•  ì´ìŠˆ

ë¸”ë¡œê·¸ ì»¨í…ì¸  ì›ë³¸ì„ ContentLayer ë¡œ ì œì‘ì„ í•˜ë©´ì„œ ë¬¸ì œì ì´ ì—¬ëŸ¿ ë°œê²¬í•˜ê²Œ ë˜ì—ˆë‹¤.

- ì»¨í…ì¸ ì˜ ë‚´ìš©ì´ `dangerouslySetInnerHTML`ë¥¼ í†µí•´ ë‚´ë¶€ HTML ì„ ì§ì ‘ ì ìš©í•˜ê³  ìˆì–´, í¬ìŠ¤íŠ¸ ë‚´ìš© ìì²´ë‘ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ê°€ ì–´ë ¤ì›€. ( ì˜ˆ : ëª©ì°¨ ê¸°ëŠ¥ )
    - íŠ¹íˆ ì›ë˜ ì½”ë“œ ë‚´ìš©ìœ¼ë¡œ ë³´ì—¬ì£¼ë ¤ê³  ë„£ì€ HTML íƒœê·¸ë‚˜ ì½”ë“œ ë‚´ìš©ì´ `innerHTML` ë¡œ ë“¤ì–´ê°€ì„œ ëˆ„ë½ë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤ íŠ¹íˆ `import` ëŠ” ê²°ê³¼ë¬¼ì— ë³´ì´ì§€ ì•Šì•˜ë‹¤.
- ì½”ë“œë¸”ë¡ì˜ ë‚´ìš©ì´ í•œ ê°€ì§€ ìƒ‰ìœ¼ë¡œ ë‚˜ì˜¤ê³  ìˆì–´, í¬ë§·ì— ë§ì¶˜ ìƒ‰ì„ ë„£ê³  ì‹¶ë‹¤.
    
    ![](https://file.notion.so/f/f/b67b8caf-0e30-4e9a-b6db-84175dd949a3/d1b3b1cd-1f6e-4282-afbf-a32e57b5dc9e/Untitled.png?id=e540ca8c-729d-4135-bea3-1057bd256c43&table=block&spaceId=b67b8caf-0e30-4e9a-b6db-84175dd949a3&expirationTimestamp=1706680800000&signature=4hupLKChPOqaAoOw2TSgiZxEuNnAumNxPjGdBcrEAZk&downloadName=Untitled.png)

í•˜ë‚˜ì”© í•´ê²°í•˜ìë©´ ì „ìëŠ” **mdx**ë¡œ, í›„ìëŠ” **rehype** ê³¼ì •ì˜ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆì—ˆë‹¤.

# MDX

ê³µì‹ ì‚¬ì´íŠ¸ : [https://mdxjs.com/](https://mdxjs.com/)

contentLayer ê°€ì´ë“œ : [https://contentlayer.dev/docs/sources/files/mdx-d747e46d](https://contentlayer.dev/docs/sources/files/mdx-d747e46d)

MDX ëŠ” ê°„ë‹¨íˆ ìš”ì•½í•˜ë©´ JSX ì»´í¬ë„ŒíŠ¸ ë¬¸ë²•ì„ ë§ˆí¬ ë‹¤ìš´ì— ë„£ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í˜•ì‹ì´ë‹¤. ì›ë˜ë¶€í„° ì´ ë‚´ìš©ì€ ì»´í¬ë„ŒíŠ¸ë¡œì„œ ì‚¬ìš©ëœ ë¬¸ë²•ì„ì„ ë¯¸ë¦¬ ë„£ê²Œ í•˜ì—¬, contentLayer ê°€ ì˜ëª» íŒŒì‹±í•˜ëŠ” ìƒí™©ì„ ë§‰ì„ ìˆ˜ ìˆì—ˆë‹¤. 

ì›ë³¸ì˜ í™•ì¥ìë¥¼ `*.md` ì—ì„œ `*.mdx` ë¡œ ìˆ˜ì •í•˜ì˜€ê³ , `contentlayer.config.ts`ì„¤ì •ì„ mdx ë¥¼ ì‚¬ìš©í•˜ë„ë¡, ë³€ê²½í•˜ì˜€ë‹¤.

```jsx
export const Post = defineDocumentType(() => ({
  name: "Post",
  filePathPattern: `**/*.mdx`,
  contentType: "mdx",
	...
}));
```

MDX ëŠ” `useMDXComponent` í›…ìœ¼ë¡œ NextJS ì»´í¬ë„ŒíŠ¸ë¡œì„œ í™œìš©í•  ìˆ˜ ìˆì–´, í¬ìŠ¤íŠ¸ í˜ì´ì§€ì— ë³´ì—¬ì•¼í•  ë‚´ìš©ì„ ì´í•˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ì˜€ë‹¤. ë” ì´ìƒ `dangerouslySetInnerHTML` ì— ë„£ì§€ ì•ŠëŠ”ë‹¤. 

ë˜í•œ mdx ì—ì„œ íŒŒì‹±ëœ ê±´ `post.body.code` ë¥¼ `MDXContent` ë¡œ ì¬êµ¬ì„±í•œë‹¤.

`Components/Post/index.tsx`

```jsx
import { useMDXComponent } from "next-contentlayer/hooks"

const PostComponent = ({ post }: { post: Post }) => {
  const MDXContent = useMDXComponent(post.body.code);

  return <MDXContent />
}
```

ì´ì œ ë¸”ë¡œê·¸ ê¸€ì— import ë¼ëŠ” ë‹¨ì–´ê°€ ì˜ ë‚˜ì˜¤ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤. 

ëª©ì°¨ ê¸°ëŠ¥ì„ ë§Œë“¤ê¸° ì•ì„œ ì•„ë˜ ì²˜ëŸ¼ `nodeSearcher` ë ˆí¼ëŸ°ìŠ¤ë¡œ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë¥¼ ëŒ€ì‘í•´ë³´ë‹ˆ `h1` `h2` `h3` ê°€ ëª‡ ê°œì¸ì§€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ì¦‰ ì´ì œ contentLayer ì˜ ê²°ê³¼ë¬¼ì€ ë˜ í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ì²˜ëŸ¼ ë™ì‘í•œë‹¤.

```jsx
import { useMDXComponent } from "next-contentlayer/hooks"

const PostComponent = ({ post }: { post: Post }) => {
  const MDXContent = useMDXComponent(post.body.code);

  const nodeSearcher = useCallback((node: HTMLDivElement) => {
    if (node == null) {
      return;
    }
    const sections: NodeListOf<HTMLHeadElement> = node.querySelectorAll("h1,h2,h3");
    const headArray: HTMLHeadElement[] = Array.from(sections);
  }

  return (
		<div ref={nodeSearcher}>
      <MDXContent />
    </div>)
}
```

# rehype

**ê³µì‹ ë¬¸ì„œ** : [https://github.com/rehypejs/rehype](https://github.com/rehypejs/rehype)

rehype ë€ HTML ì„ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë„êµ¬ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ContentLayer ì˜ ê²°ê³¼ë¬¼ì¸ HTML êµ¬ì¡°ì— Code ë¶€ë¶„ì— í”ŒëŸ¬ê·¸ì¸ì„ ë„ì…í•˜ì—¬ DOM êµ¬ì¡°ê°€ ë³€ê²½ëœë‹¤. 

ê¸°ì¡´ì—ëŠ” `<code>` íƒœê·¸ ë‚´ë¶€ì— í…ìŠ¤íŠ¸ë§Œ ì—¬ëŸ¬ ì¤„ì´ ë“¤ì–´ê°„ í˜•íƒœì˜€ë‹¤ë©´ ì´ í”ŒëŸ¬ê·¸ì¸ì„ ì ìš©ì‹œ, `<code>` ë‚´ë¶€ì— ì–¸ì–´ í¬ë§·ì— ë§ì¶°ì„œ ì—¬ëŸ¬ `<span>` íƒœê·¸ë“¤ë¡œ ë¶„í• ë˜ì–´ í™”ë©´ì— ë³´ì—¬ì£¼ê²Œëœë‹¤. 

ê´€ë ¨ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì—¬ëŸ¬ê°€ì§€ ìˆì§€ë§Œ, ê·¸ ì¤‘ ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ì„œ ë‹¤ì–‘í•œ í…Œë§ˆë¥¼ ì œê³µí•˜ëŠ” **[rehypePrettyCode](https://rehype-pretty-code.netlify.app/)** ë¥¼ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.

ì¼ë‹¨ ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì˜€ë‹¤.

`yarn add rehype-pretty-code shikiji@^0.9.0`

ì—¬ê¸°ì„œ `shikiji` íŒ¨í‚¤ì§€ëŠ” ì½”ë“œ í¬ë§·ì„ ë¶„í• í•˜ëŠ” ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤. ì—¬ê¸°ì„œ ì°¾ì•„ë³¸ ë ˆí¼ëŸ°ìŠ¤ì—ì„œëŠ” `shiki` ë¥¼ ì„¤ì¹˜í•˜ì§€ë§Œ, 2024ë…„ 1ì›” ê¸°ì¤€ì˜ ìµœì‹  `rehype-pretty-code` ì™€ `shiki` ëŠ” ì„œë¡œ ë²„ì „ì´ ë§ì§€ ì•Šì•„ ì½”ë“œê°„ ê°„ê²©ì´ ë„ˆë¬´ ë²Œì–´ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.   

íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜ í–ˆë‹¤ë©´ `contentlayer.config.ts` ì—ì„œ `rehypePlugins` ì„¤ì •ì„ ë”°ë¡œ ì¶”ê°€í•˜ì˜€ë‹¤.

```jsx
import rehypePrettyCode from "rehype-pretty-code";

export default makeSource({
  contentDirPath: "posts",
  disableImportAliasWarning: true,
  documentTypes: [Post],
  mdx: {
    remarkPlugins: [],
    rehypePlugins: [
      [
        rehypePrettyCode,
        {
          theme: "github-dark",
          keepBackground: true,
        },
      ],
    ] as Pluggable[],
  },
});
```

ì°¸ê³ ë¡œ ì´ ì„¤ì •ì€ contentLayer ë§Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ì•„ë‹ˆë¯€ë¡œ, rehype ì™€ remark ê³µì‹ë¬¸ì„œì— ìƒì„¸íˆ ì„¤ëª…ë˜ì–´ìˆë‹¤.

<aside>
ğŸ”— **Remark**

ì°¸ê³ ì˜ ì°¸ê³ ë¡œ [remark](https://github.com/remarkjs/remark) ëŠ” ë§ˆí¬ ë‹¤ìš´ì„ ë³€í˜•í•˜ëŠ” ë„êµ¬ì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ contentLayerê°€ ì»¨í…ì¸ ë¥¼ ì œì‘í•  ë•Œ remark ì™€ rehype ë¥¼ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´.

```
MDX ----> remark AST ------> rehype AST --------> HTML
    parse            convert            stringify
```

ìˆœì„œë¡œ ì‹¤í–‰ëœë‹¤.

</aside>

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•¨ìœ¼ë¡œì„œ í¬ìŠ¤íŠ¸ì˜ ë‚´ìš©ì´ ë…¸ì…˜ì˜ ìŠ¤íƒ€ì¼ê³¼ ë¹„ìŠ·í•˜ê²Œ ì œì‘í•  ìˆ˜ ìˆì—ˆë‹¤.